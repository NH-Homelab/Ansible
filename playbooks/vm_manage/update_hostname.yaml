# Updates the /etc/hosts file for the target machine
#
# Example Usage:
# ansible-playbook update_hostname.yaml \
#   -e "target=k8s" \
#   -e "hostname=node1"

---
- name: Configure hostname on a new VM
  hosts: "{{ target }}"
  become: yes

  vars:
    new_hostname: "{{ hostname }}"
    target_node: "{{ target }}"

  tasks:
    - name: Set system hostname
      ansible.builtin.hostname:
        name: "{{ new_hostname }}"
    
    - name: Update /etc/hosts entry
      ansible.builtin.lineinfile:
        path: /etc/hosts
        regexp: "^127\\.0\\.1\\.1"
        line: "127.0.1.1  {{ new_hostname }}"
        state: present
